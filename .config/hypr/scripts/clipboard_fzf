#!/bin/bash

# This script toggles a floating foot terminal for clipboard history.
# If the clipboard window is open, it closes it.
# If it's not open, it creates it.
#
# Dependencies:
# - hyprctl (for window management)
# - jq (for parsing JSON output from hyprctl)
# - foot, cliphist, fzf, wl-copy

# The unique app-id we assign to our foot terminal
APP_ID="clipboard"

# Check if a window with the specified app-id already exists
# We use hyprctl to get all client info in JSON, then jq to parse it.
# We select the window where the 'class' matches our APP_ID and get its address.
WINDOW_ADDRESS=$(hyprctl clients -j | jq -r --arg app_id "$APP_ID" '.[] | select(.class == $app_id) | .address')

# If the WINDOW_ADDRESS variable is not empty, a window was found
if [ -n "$WINDOW_ADDRESS" ]; then
  # Close the existing window using its address
  hyprctl dispatch closewindow address:"$WINDOW_ADDRESS"
else
  # No window found, so we launch a new one
  foot -a "$APP_ID" -e bash -c 'cliphist list | fzf --style full --reverse | cliphist decode | wl-copy'
fi
